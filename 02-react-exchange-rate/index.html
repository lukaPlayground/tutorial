<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í™˜ìœ¨ ê³„ì‚°ê¸°</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface2: #22263a;
      --border: rgba(255,255,255,0.07);
      --text: #e2e8f0;
      --text-muted: rgba(226,232,240,0.4);
      --accent: #3b82f6;
      --accent2: #60a5fa;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 60px 20px;
    }

    .container { width: 100%; max-width: 480px; }

    header { margin-bottom: 32px; }
    header h1 { font-size: 26px; font-weight: 700; letter-spacing: -0.5px; }
    header h1 span {
      background: linear-gradient(135deg, #3b82f6, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    header p { font-size: 13px; color: var(--text-muted); margin-top: 6px; }

    /* Card */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 12px;
    }

    .card-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    /* Currency row */
    .currency-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .currency-select {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      outline: none;
      flex-shrink: 0;
      width: 100px;
      appearance: none;
      -webkit-appearance: none;
      text-align: center;
    }

    .currency-select:focus { border-color: rgba(59,130,246,0.5); }

    .amount-input {
      flex: 1;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 14px;
      color: var(--text);
      font-size: 22px;
      font-weight: 700;
      outline: none;
      width: 100%;
      transition: border-color 0.2s;
    }

    .amount-input::placeholder { color: var(--text-muted); font-weight: 400; font-size: 16px; }
    .amount-input:focus { border-color: rgba(59,130,246,0.5); }

    /* Swap button */
    .swap-wrap {
      display: flex;
      justify-content: center;
      margin: 4px 0;
    }

    .swap-btn {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      transition: background 0.2s, transform 0.2s;
      color: var(--text-muted);
    }

    .swap-btn:hover { background: rgba(59,130,246,0.15); color: var(--accent2); transform: rotate(180deg); }

    /* Result */
    .result-amount {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #3b82f6, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -1px;
    }

    .result-rate {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    /* Quick currencies */
    .quick-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .quick-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    .quick-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 6px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-btn:hover {
      border-color: rgba(59,130,246,0.4);
      background: rgba(59,130,246,0.08);
    }

    .quick-btn .flag { font-size: 20px; display: block; margin-bottom: 3px; }
    .quick-btn .code { font-size: 11px; font-weight: 600; color: var(--text-muted); }
    .quick-btn .rate { font-size: 12px; font-weight: 700; color: var(--accent2); margin-top: 2px; }

    /* Status */
    .status-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 16px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .status-dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-right: 5px;
    }

    .status-dot.live { background: #22c55e; box-shadow: 0 0 6px #22c55e; }
    .status-dot.loading { background: #fbbf24; }
    .status-dot.error { background: #f87171; }

    /* Loading / Error */
    .loading-text { color: var(--text-muted); font-size: 14px; padding: 12px 0; }
    .error-text { color: #f87171; font-size: 13px; margin-top: 8px; }

    .refresh-btn {
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 4px 12px;
      color: var(--text-muted);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .refresh-btn:hover { border-color: var(--accent); color: var(--accent2); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ì§€ì› í†µí™” ëª©ë¡
    const CURRENCIES = [
      { code: 'USD', flag: 'ğŸ‡ºğŸ‡¸', name: 'ë¯¸êµ­ ë‹¬ëŸ¬' },
      { code: 'KRW', flag: 'ğŸ‡°ğŸ‡·', name: 'í•œêµ­ ì›' },
      { code: 'EUR', flag: 'ğŸ‡ªğŸ‡º', name: 'ìœ ë¡œ' },
      { code: 'JPY', flag: 'ğŸ‡¯ğŸ‡µ', name: 'ì¼ë³¸ ì—”' },
      { code: 'GBP', flag: 'ğŸ‡¬ğŸ‡§', name: 'ì˜êµ­ íŒŒìš´ë“œ' },
      { code: 'CNY', flag: 'ğŸ‡¨ğŸ‡³', name: 'ì¤‘êµ­ ìœ„ì•ˆ' },
      { code: 'CAD', flag: 'ğŸ‡¨ğŸ‡¦', name: 'ìºë‚˜ë‹¤ ë‹¬ëŸ¬' },
      { code: 'AUD', flag: 'ğŸ‡¦ğŸ‡º', name: 'í˜¸ì£¼ ë‹¬ëŸ¬' },
      { code: 'CHF', flag: 'ğŸ‡¨ğŸ‡­', name: 'ìŠ¤ìœ„ìŠ¤ í”„ë‘' },
      { code: 'HKD', flag: 'ğŸ‡­ğŸ‡°', name: 'í™ì½© ë‹¬ëŸ¬' },
      { code: 'SGD', flag: 'ğŸ‡¸ğŸ‡¬', name: 'ì‹±ê°€í¬ë¥´ ë‹¬ëŸ¬' },
      { code: 'MXN', flag: 'ğŸ‡²ğŸ‡½', name: 'ë©•ì‹œì½” í˜ì†Œ' },
    ];

    const BASE_QUICK = ['KRW', 'USD', 'CNY', 'EUR'];
    const FALLBACK_QUICK = 'JPY'; // fromCurrencyê°€ BASE_QUICK ì¤‘ í•˜ë‚˜ì¼ ë•Œ ëŒ€ì²´

    // ìˆ«ì í¬ë§·
    function fmt(val, code) {
      if (!val && val !== 0) return 'â€”';
      const locale = code === 'KRW' || code === 'JPY' ? 'ko-KR' : 'en-US';
      const digits = (code === 'KRW' || code === 'JPY') ? 0 : 2;
      return new Intl.NumberFormat(locale, {
        minimumFractionDigits: digits,
        maximumFractionDigits: digits,
      }).format(val);
    }

    // â”€â”€ ì»¤ìŠ¤í…€ í›…: í™˜ìœ¨ fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function useExchangeRates(baseCurrency) {
      const [rates, setRates]       = useState(null);
      const [status, setStatus]     = useState('loading'); // loading | live | error
      const [updatedAt, setUpdatedAt] = useState(null);

      const fetchRates = useCallback(async () => {
        setStatus('loading');
        try {
          const res  = await fetch(`https://api.exchangerate-api.com/v4/latest/${baseCurrency}`);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          setRates(data.rates);
          setUpdatedAt(new Date().toLocaleTimeString('ko-KR'));
          setStatus('live');
        } catch (e) {
          setStatus('error');
        }
      }, [baseCurrency]);

      useEffect(() => {
        fetchRates();
      }, [fetchRates]);

      return { rates, status, updatedAt, refetch: fetchRates };
    }

    // â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function App() {
      const [fromCurrency, setFromCurrency] = useState('USD');
      const [toCurrency,   setToCurrency]   = useState('KRW');
      const [amount, setAmount]             = useState('1');

      const { rates, status, updatedAt, refetch } = useExchangeRates(fromCurrency);

      // í™˜ì‚° ê²°ê³¼
      const converted = (() => {
        if (!rates || !amount) return null;
        const num = parseFloat(amount.replace(/,/g, ''));
        if (isNaN(num)) return null;
        return num * (rates[toCurrency] ?? 0);
      })();

      const rate = rates ? rates[toCurrency] : null;

      // fromCurrency ë³€ê²½ â€” toCurrencyë‘ ê°™ì•„ì§€ë©´ ìë™ swap
      function handleFromCurrencyChange(newFrom) {
        if (newFrom === toCurrency) {
          setToCurrency(fromCurrency);
        }
        setFromCurrency(newFrom);
      }

      // í†µí™” ìŠ¤ì™‘
      function handleSwap() {
        setFromCurrency(toCurrency);
        setToCurrency(fromCurrency);
      }

      // ì£¼ìš”í†µí™” ëª©ë¡ â€” fromCurrency ì œì™¸, 4ê°œ ìœ ì§€
      const quickList = BASE_QUICK.includes(fromCurrency)
        ? BASE_QUICK.filter(c => c !== fromCurrency).concat([FALLBACK_QUICK])
        : BASE_QUICK;

      // ì…ë ¥ ìˆ«ìë§Œ í—ˆìš©
      function handleAmountChange(e) {
        const val = e.target.value.replace(/[^0-9.]/g, '');
        setAmount(val);
      }

      return (
        <div className="container">
          <header>
            <h1>í™˜ìœ¨ <span>ê³„ì‚°ê¸°</span></h1>
            <p>ì‹¤ì‹œê°„ í™˜ìœ¨ ê¸°ë°˜ Â· ExchangeRate-API</p>
          </header>

          {/* From */}
          <div className="card">
            <div className="card-label">ë³€í™˜ ê¸ˆì•¡</div>
            <div className="currency-row">
              <select
                className="currency-select"
                value={fromCurrency}
                onChange={e => handleFromCurrencyChange(e.target.value)}
              >
                {CURRENCIES.map(c => (
                  <option key={c.code} value={c.code}>{c.code}</option>
                ))}
              </select>
              <input
                className="amount-input"
                type="text"
                inputMode="decimal"
                placeholder="ê¸ˆì•¡ ì…ë ¥"
                value={amount}
                onChange={handleAmountChange}
              />
            </div>
          </div>

          {/* Swap */}
          <div className="swap-wrap">
            <button className="swap-btn" onClick={handleSwap} title="í†µí™” êµí™˜">â‡…</button>
          </div>

          {/* To */}
          <div className="card">
            <div className="card-label">í™˜ì‚° ê²°ê³¼</div>
            <div className="currency-row">
              <select
                className="currency-select"
                value={toCurrency}
                onChange={e => setToCurrency(e.target.value)}
              >
                {CURRENCIES.map(c => (
                  <option key={c.code} value={c.code}>{c.code}</option>
                ))}
              </select>
              <div style={{ flex: 1 }}>
                {status === 'loading' && <p className="loading-text">í™˜ìœ¨ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>}
                {status === 'error'   && <p className="error-text">API ì˜¤ë¥˜. ì ì‹œ í›„ ì¬ì‹œë„</p>}
                {status === 'live'    && (
                  <div className="result-amount">
                    {converted !== null ? fmt(converted, toCurrency) : 'â€”'}
                  </div>
                )}
              </div>
            </div>
            {status === 'live' && rate && (
              <p className="result-rate">
                1 {fromCurrency} = {fmt(rate, toCurrency)} {toCurrency}
              </p>
            )}
          </div>

          {/* Quick currencies */}
          <div style={{ marginTop: '20px' }}>
            <div className="quick-label">1 {fromCurrency} ê¸°ì¤€ ì£¼ìš” í†µí™”</div>
            <div className="quick-grid">
              {quickList.map(code => {
                const c = CURRENCIES.find(x => x.code === code);
                const r = rates?.[code];
                return (
                  <div
                    key={code}
                    className="quick-btn"
                    onClick={() => setToCurrency(code)}
                  >
                    <span className="flag">{c.flag}</span>
                    <span className="code">{code}</span>
                    <div className="rate">{r ? fmt(r, code) : 'â€¦'}</div>
                  </div>
                );
              })}
            </div>
          </div>

          {/* Status bar */}
          <div className="status-row">
            <span>
              <span className={`status-dot ${status}`}></span>
              {status === 'live'    && `ì—…ë°ì´íŠ¸: ${updatedAt}`}
              {status === 'loading' && 'í™˜ìœ¨ ë¡œë”© ì¤‘...'}
              {status === 'error'   && 'API ì—°ê²° ì‹¤íŒ¨'}
            </span>
            <button className="refresh-btn" onClick={refetch}>â†º ìƒˆë¡œê³ ì¹¨</button>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
