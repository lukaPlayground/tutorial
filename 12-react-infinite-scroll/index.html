<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë¬´í•œ ìŠ¤í¬ë¡¤ ê°¤ëŸ¬ë¦¬</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0b1120;
      --surface: rgba(255,255,255,0.05);
      --border: rgba(255,255,255,0.10);
      --text: #f0f4ff;
      --muted: rgba(240,244,255,0.45);
      --accent: #60a5fa;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(11, 17, 32, 0.88);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0 24px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-title { font-size: 18px; font-weight: 800; letter-spacing: -0.5px; }
    .header-count { font-size: 13px; color: var(--muted); }

    /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wrap {
      max-width: 960px;
      margin: 0 auto;
      padding: 28px 20px 80px;
    }

    /* â”€â”€ Photo grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    @media (max-width: 640px) {
      .photo-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
    }

    /* â”€â”€ Photo card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .photo-card {
      border-radius: 14px;
      overflow: hidden;
      background: var(--surface);
      border: 1px solid var(--border);
      transition: transform .2s, border-color .2s;
      cursor: pointer;
    }

    .photo-card:hover {
      transform: translateY(-4px);
      border-color: rgba(255,255,255,0.22);
    }

    .photo-img {
      width: 100%;
      aspect-ratio: 4/3;
      object-fit: cover;
      display: block;
      background: rgba(255,255,255,0.04);
    }

    .photo-info { padding: 12px 14px; }
    .photo-id   { font-size: 11px; color: var(--accent); font-weight: 700; margin-bottom: 4px; }

    .photo-title {
      font-size: 13px;
      line-height: 1.5;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    /* â”€â”€ Skeleton â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes shimmer {
      from { background-position: 200% 0; }
      to   { background-position: -200% 0; }
    }

    .skeleton-card {
      border-radius: 14px;
      overflow: hidden;
      background: var(--surface);
      border: 1px solid var(--border);
    }

    .skeleton-img,
    .skeleton-line {
      background: linear-gradient(
        90deg,
        rgba(255,255,255,0.04) 25%,
        rgba(255,255,255,0.11) 50%,
        rgba(255,255,255,0.04) 75%
      );
      background-size: 200% 100%;
      animation: shimmer 1.4s ease-in-out infinite;
    }

    .skeleton-img { width: 100%; aspect-ratio: 4/3; }

    .skeleton-text {
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .skeleton-line { height: 10px; border-radius: 5px; }

    /* â”€â”€ Sentinel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sentinel-area {
      margin-top: 32px;
      min-height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin .7s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ End / Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .end-msg {
      text-align: center;
      padding: 40px 0 0;
      color: var(--muted);
      font-size: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .end-icon  { font-size: 36px; }
    .end-count { font-weight: 700; color: var(--text); }

    .error-msg {
      text-align: center;
      color: #f87171;
      font-size: 14px;
      padding: 24px 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    const PER_PAGE = 12;

    /* â”€â”€â”€ useInfiniteScroll â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     * IntersectionObserver ê¸°ë°˜ ë¬´í•œ ìŠ¤í¬ë¡¤ ì»¤ìŠ¤í…€ í›….
     *
     * loading=true ë˜ëŠ” hasMore=false ì¼ ë•Œ observerë¥¼ ì œê±°í•´
     * ì¤‘ë³µ í˜¸ì¶œì„ ì›ì²œ ì°¨ë‹¨í•œë‹¤. ë¡œë”©ì´ ëë‚˜ë©´ observerë¥¼ ì¬ìƒì„±í•˜ê³ ,
     * sentinelì´ ì—¬ì „íˆ ë·°í¬íŠ¸ ì•ˆì— ìˆìœ¼ë©´ ì¦‰ì‹œ ì¬ë°œí™”í•œë‹¤.
     */
    function useInfiniteScroll(onIntersect, loading, hasMore) {
      const sentinelRef = useRef(null);
      const callbackRef = useRef(onIntersect);

      // observer ì¬ìƒì„± ì—†ì´ ìµœì‹  ì½œë°± ìœ ì§€
      useEffect(() => { callbackRef.current = onIntersect; });

      useEffect(() => {
        if (loading || !hasMore) return;   // ë¡œë”© ì¤‘Â·ë” ì—†ìœ¼ë©´ ë¹„í™œì„±

        const observer = new IntersectionObserver(
          ([entry]) => { if (entry.isIntersecting) callbackRef.current(); },
          { rootMargin: '300px' }          // 300px ì•ì—ì„œ ë¯¸ë¦¬ ë¡œë“œ
        );

        const el = sentinelRef.current;
        if (el) observer.observe(el);
        return () => { if (el) observer.unobserve(el); };
      }, [loading, hasMore]);              // ë‘ ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ì¬ì„¤ì •

      return sentinelRef;
    }

    /* â”€â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function fetchPhotos(page) {
      const res = await fetch(
        `https://jsonplaceholder.typicode.com/photos?_page=${page}&_limit=${PER_PAGE}`
      );
      if (!res.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      return res.json();
    }

    /* â”€â”€â”€ PhotoCard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function PhotoCard({ photo }) {
      return (
        <div className="photo-card">
          <img
            className="photo-img"
            src={`https://picsum.photos/seed/${photo.id}/400/300`}
            alt={photo.title}
            loading="lazy"
          />
          <div className="photo-info">
            <div className="photo-id">#{photo.id}</div>
            <div className="photo-title">{photo.title}</div>
          </div>
        </div>
      );
    }

    /* â”€â”€â”€ SkeletonCard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function SkeletonCard() {
      return (
        <div className="skeleton-card">
          <div className="skeleton-img" />
          <div className="skeleton-text">
            <div className="skeleton-line" style={{ width: '35%' }} />
            <div className="skeleton-line" style={{ width: '88%' }} />
            <div className="skeleton-line" style={{ width: '65%' }} />
          </div>
        </div>
      );
    }

    /* â”€â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function App() {
      const [photos,  setPhotos]  = useState([]);
      const [loading, setLoading] = useState(false);
      const [hasMore, setHasMore] = useState(true);
      const [error,   setError]   = useState(null);

      const pageRef = useRef(1);

      /*
       * loadMoreëŠ” useCallbackìœ¼ë¡œ ì•ˆì •í™”.
       * ê°€ë³€ ê°’(page)ì€ refë¡œ ì°¸ì¡°í•˜ë¯€ë¡œ depsê°€ ë¹„ì–´ë„ í•­ìƒ ìµœì‹  ê°’ì„ ì½ëŠ”ë‹¤.
       */
      const loadMore = useCallback(async () => {
        setLoading(true);
        setError(null);
        try {
          const data = await fetchPhotos(pageRef.current);
          if (data.length < PER_PAGE) setHasMore(false);
          if (data.length > 0) {
            setPhotos(prev => [...prev, ...data]);
            pageRef.current += 1;
          }
        } catch (e) {
          setError(e.message);
        } finally {
          setLoading(false);
        }
      }, []);

      // sentinel DOM ìš”ì†Œ â€” IntersectionObserverê°€ ê°ì‹œ
      const sentinelRef = useInfiniteScroll(loadMore, loading, hasMore);

      return (
        <>
          <header className="header">
            <div className="header-title">ğŸ“· í¬í†  í”¼ë“œ</div>
            <div className="header-count">{photos.length.toLocaleString()}ì¥ ë¡œë“œë¨</div>
          </header>

          <div className="wrap">
            {/* ì‚¬ì§„ ê·¸ë¦¬ë“œ */}
            <div className="photo-grid">
              {photos.map(photo => (
                <PhotoCard key={photo.id} photo={photo} />
              ))}
              {/* ë¡œë”© ì¤‘: ìŠ¤ì¼ˆë ˆí†¤ ì¹´ë“œ */}
              {loading && Array.from({ length: PER_PAGE }, (_, i) => (
                <SkeletonCard key={`sk-${i}`} />
              ))}
            </div>

            {/* ì—ëŸ¬ */}
            {error && (
              <p className="error-msg">ğŸ˜• {error} â€” ìŠ¤í¬ë¡¤í•˜ë©´ ì¬ì‹œë„í•©ë‹ˆë‹¤.</p>
            )}

            {/*
             * ì„¼í‹°ë„: IntersectionObserverì˜ ê°ì‹œ ëŒ€ìƒ.
             * ë·°í¬íŠ¸ 300px ì•ì—ì„œ loadMoreê°€ ë°œí™”í•œë‹¤.
             */}
            <div className="sentinel-area" ref={sentinelRef}>
              {loading && <div className="spinner" />}
            </div>

            {/* ë */}
            {!hasMore && !loading && (
              <div className="end-msg">
                <div className="end-icon">âœ…</div>
                <div>ëª¨ë“  ì‚¬ì§„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤</div>
                <div className="end-count">ì´ {photos.length.toLocaleString()}ì¥</div>
              </div>
            )}
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
